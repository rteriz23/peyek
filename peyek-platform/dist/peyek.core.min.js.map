{"version":3,"file":"peyek.core.min.js","sources":["../packages/core/src/utils.js","../packages/core/src/modal.js","../packages/core/src/api.js","../packages/core/src/peyek.js"],"sourcesContent":["/**\r\n * P.E.Y.E.K Core Utilities\r\n */\r\n\r\n/**\r\n * Creates an HTML element with attributes and children.\r\n * @param {string} tag\r\n * @param {Object} attributes\r\n * @param {Array<HTMLElement|string>} children\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tag, attributes = {}, children = []) {\r\n    const el = document.createElement(tag);\r\n\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n        if (key.startsWith('on') && typeof value === 'function') {\r\n            const event = key.substring(2).toLowerCase();\r\n            el.addEventListener(event, value);\r\n        } else if (key === 'className') {\r\n            el.className = value;\r\n        } else if (key === 'style' && typeof value === 'object') {\r\n            Object.assign(el.style, value);\r\n        } else {\r\n            el.setAttribute(key, value);\r\n        }\r\n    }\r\n\r\n    children.forEach(child => {\r\n        if (typeof child === 'string') {\r\n            el.appendChild(document.createTextNode(child));\r\n        } else if (child instanceof HTMLElement) {\r\n            el.appendChild(child);\r\n        }\r\n    });\r\n\r\n    return el;\r\n}\r\n\r\n/**\r\n * Generates a unique ID\r\n * @returns {string}\r\n */\r\nexport function generateUniqueId() {\r\n    return 'peyek_' + Math.random().toString(36).substr(2, 9);\r\n}\r\n","import { createElement, generateUniqueId } from './utils.js';\r\n\r\n/**\r\n * CSS injected for modals\r\n */\r\nconst MODAL_CSS = `\r\n  .peyek-modal-overlay {\r\n    position: fixed;\r\n    top: 0; left: 0; right: 0; bottom: 0;\r\n    background: rgba(0, 0, 0, 0.5);\r\n    display: flex;\r\n    align-items: center;\r\n    justify-content: center;\r\n    z-index: 9999;\r\n    opacity: 0;\r\n    transition: opacity 0.3s ease;\r\n    backdrop-filter: blur(2px);\r\n  }\r\n  .peyek-modal-overlay.peyek-modal-show {\r\n    opacity: 1;\r\n  }\r\n  .peyek-modal-content {\r\n    background: #fff;\r\n    border-radius: 8px;\r\n    padding: 24px;\r\n    max-width: 500px;\r\n    width: 90%;\r\n    box-shadow: 0 10px 25px rgba(0,0,0,0.1);\r\n    transform: scale(0.95) translateY(20px);\r\n    transition: transform 0.3s ease;\r\n  }\r\n  .peyek-modal-overlay.peyek-modal-show .peyek-modal-content {\r\n    transform: scale(1) translateY(0);\r\n  }\r\n  .peyek-modal-header {\r\n    display: flex;\r\n    justify-content: space-between;\r\n    align-items: center;\r\n    border-bottom: 1px solid #eee;\r\n    padding-bottom: 12px;\r\n    margin-bottom: 16px;\r\n  }\r\n  .peyek-modal-title {\r\n    margin: 0;\r\n    font-size: 1.25rem;\r\n    color: #333;\r\n    font-family: system-ui, -apple-system, sans-serif;\r\n    font-weight: 600;\r\n  }\r\n  .peyek-modal-close {\r\n    background: none;\r\n    border: none;\r\n    font-size: 1.5rem;\r\n    cursor: pointer;\r\n    color: #999;\r\n    line-height: 1;\r\n  }\r\n  .peyek-modal-close:hover {\r\n    color: #333;\r\n  }\r\n  .peyek-modal-body {\r\n    font-family: system-ui, -apple-system, sans-serif;\r\n    color: #555;\r\n    line-height: 1.6;\r\n  }\r\n`;\r\n\r\n/**\r\n * P.E.Y.E.K Auto Modal System\r\n */\r\nexport class Modal {\r\n    static initStyles() {\r\n        if (!document.getElementById('peyek-modal-styles')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'peyek-modal-styles';\r\n            style.textContent = MODAL_CSS;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Shows a modal dialog dynamically\r\n     * @param {Object} options \r\n     * @param {string} options.title\r\n     * @param {string|HTMLElement} options.content\r\n     * @param {boolean} [options.closeOnClickOutside=true]\r\n     * @returns {string} modalId\r\n     */\r\n    static show(options = {}) {\r\n        this.initStyles();\r\n\r\n        const { title = 'Alert', content = '', closeOnClickOutside = true } = options;\r\n        const modalId = generateUniqueId();\r\n\r\n        const overlay = createElement('div', {\r\n            id: modalId,\r\n            className: 'peyek-modal-overlay'\r\n        });\r\n\r\n        const modalBox = createElement('div', { className: 'peyek-modal-content' });\r\n\r\n        const header = createElement('div', { className: 'peyek-modal-header' }, [\r\n            createElement('h2', { className: 'peyek-modal-title' }, [title]),\r\n            createElement('button', {\r\n                className: 'peyek-modal-close',\r\n                innerHTML: '&times;', // HTML entity for multiplication sign, works well as close button\r\n                onClick: () => this.close(modalId)\r\n            })\r\n        ]);\r\n\r\n        const body = createElement('div', { className: 'peyek-modal-body' });\r\n        if (typeof content === 'string') {\r\n            body.innerHTML = content;\r\n        } else {\r\n            body.appendChild(content);\r\n        }\r\n\r\n        modalBox.appendChild(header);\r\n        modalBox.appendChild(body);\r\n        overlay.appendChild(modalBox);\r\n\r\n        if (closeOnClickOutside) {\r\n            overlay.addEventListener('click', (e) => {\r\n                if (e.target === overlay) {\r\n                    this.close(modalId);\r\n                }\r\n            });\r\n        }\r\n\r\n        document.body.appendChild(overlay);\r\n\r\n        // Trigger animation\r\n        requestAnimationFrame(() => {\r\n            overlay.classList.add('peyek-modal-show');\r\n        });\r\n\r\n        return modalId;\r\n    }\r\n\r\n    /**\r\n     * Closes an active modal\r\n     * @param {string} modalId \r\n     */\r\n    static close(modalId) {\r\n        const overlay = document.getElementById(modalId);\r\n        if (!overlay) return;\r\n\r\n        overlay.classList.remove('peyek-modal-show');\r\n\r\n        // Wait for animation to finish before removing\r\n        setTimeout(() => {\r\n            if (overlay.parentNode) {\r\n                overlay.parentNode.removeChild(overlay);\r\n            }\r\n        }, 300); // 300ms matches CSS transition\r\n    }\r\n}\r\n","/**\r\n * P.E.Y.E.K API Communication Layer\r\n * Yielding capability to work seamlessly with Yii/Laravel by easily providing CSRF tokens etc.\r\n */\r\nexport class API {\r\n    static defaults = {\r\n        headers: {\r\n            'Content-Type': 'application/json',\r\n            'Accept': 'application/json'\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Set global CSRF token that will be sent with all requests\r\n     * @param {string} token \r\n     * @param {string} headerName (default: 'X-CSRF-TOKEN' for Laravel/CI)\r\n     */\r\n    static setCsrfToken(token, headerName = 'X-CSRF-TOKEN') {\r\n        this.defaults.headers[headerName] = token;\r\n    }\r\n\r\n    /**\r\n     * Validate a P.E.Y.E.K license key remotely\r\n     * @param {string} licenseKey\r\n     */\r\n    static async verifyLicense(licenseKey) {\r\n        // In production this would point to the actual SaaS domain (e.g. api.peyek.com)\r\n        const backendURL = 'http://localhost:3000/api/license/verify';\r\n        return fetch(backendURL, {\r\n            method: 'POST',\r\n            headers: { 'Content-Type': 'application/json' },\r\n            body: JSON.stringify({ licenseKey, origin: window.location.origin })\r\n        }).then(res => res.json());\r\n    }\r\n\r\n    /**\r\n     * Perform an auto-configured GET request\r\n     * @param {string} url \r\n     * @param {Object} options \r\n     */\r\n    static async get(url, options = {}) {\r\n        return this.request(url, { ...options, method: 'GET' });\r\n    }\r\n\r\n    /**\r\n     * Perform an auto-configured POST request\r\n     * @param {string} url \r\n     * @param {Object} data \r\n     * @param {Object} options \r\n     */\r\n    static async post(url, data = {}, options = {}) {\r\n        return this.request(url, {\r\n            ...options,\r\n            method: 'POST',\r\n            body: JSON.stringify(data)\r\n        });\r\n    }\r\n\r\n    /**\r\n     * Base request method\r\n     */\r\n    static async request(url, options = {}) {\r\n        try {\r\n            const finalOptions = {\r\n                ...options,\r\n                headers: {\r\n                    ...this.defaults.headers,\r\n                    ...(options.headers || {})\r\n                }\r\n            };\r\n\r\n            const response = await fetch(url, finalOptions);\r\n\r\n            const isJson = response.headers.get('content-type')?.includes('application/json');\r\n            const data = isJson ? await response.json() : await response.text();\r\n\r\n            if (!response.ok) {\r\n                throw { status: response.status, data };\r\n            }\r\n\r\n            return data;\r\n        } catch (error) {\r\n            console.error('[P.E.Y.E.K API Error]', error);\r\n            throw error;\r\n        }\r\n    }\r\n}\r\n","/**\r\n * P.E.Y.E.K - Platform Extensible Yielding Engineering Kit\r\n */\r\nimport { Modal } from './modal.js';\r\nimport { API } from './api.js';\r\nimport * as Utils from './utils.js';\r\n\r\nclass PeyekCore {\r\n    constructor() {\r\n        this.Modal = Modal;\r\n        this.API = API;\r\n        this.Utils = Utils;\r\n        this.version = '1.0.0';\r\n        this.licenseKey = null;\r\n        this.isPremium = false;\r\n    }\r\n\r\n    /**\r\n     * Initialize peyek by detecting global framework properties like CSRF\r\n     */\r\n    async init(options = {}) {\r\n        console.log(`[P.E.Y.E.K] Core initialized v${this.version}`);\r\n\r\n        // Check for a license\r\n        if (options.license) {\r\n            await this.verifyLicense(options.license);\r\n        }\r\n\r\n        // Auto-detect Laravel/Yii CSRF tokens from meta tags if available\r\n        this.autoDetectCsrf();\r\n    }\r\n\r\n    /**\r\n     * Contact the SaaS backend to activate premium features\r\n     */\r\n    async verifyLicense(key) {\r\n        console.log('[P.E.Y.E.K] Validating license key...');\r\n        try {\r\n            const result = await this.API.verifyLicense(key);\r\n            if (result.valid) {\r\n                this.licenseKey = key;\r\n                this.isPremium = true;\r\n                console.log('%c[P.E.Y.E.K Premium Enabled]', 'color: #27c93f; font-weight: bold;');\r\n            } else {\r\n                console.warn('[P.E.Y.E.K] Invalid License: ' + result.error);\r\n            }\r\n        } catch (e) {\r\n            console.warn('[P.E.Y.E.K] Could not reach activation server.');\r\n        }\r\n    }\r\n\r\n    autoDetectCsrf() {\r\n        const laravelToken = document.querySelector('meta[name=\"csrf-token\"]');\r\n        if (laravelToken) {\r\n            this.API.setCsrfToken(laravelToken.getAttribute('content'));\r\n            console.log('[P.E.Y.E.K] Auto-detected Laravel CSRF token');\r\n        }\r\n\r\n        // Typical Yii2 csrf token structure\r\n        const yiiToken = document.querySelector('meta[name=\"csrf-param\"]');\r\n        const yiiTokenValue = document.querySelector('meta[name=\"csrf-token\"]');\r\n        // For Yii we usually send it in data or specific header, but this sets a baseline.\r\n        if (yiiToken && yiiTokenValue) {\r\n            this.API.setCsrfToken(yiiTokenValue.getAttribute('content'), 'X-CSRF-Token');\r\n            console.log('[P.E.Y.E.K] Auto-detected Yii CSRF token');\r\n        }\r\n    }\r\n}\r\n\r\nexport const peyek = new PeyekCore();\r\n"],"names":["createElement","tag","attributes","children","el","document","key","value","Object","entries","startsWith","event","substring","toLowerCase","addEventListener","className","assign","style","setAttribute","forEach","child","appendChild","createTextNode","HTMLElement","generateUniqueId","Math","random","toString","substr","Modal","initStyles","getElementById","id","textContent","head","show","options","this","title","content","closeOnClickOutside","modalId","overlay","modalBox","header","innerHTML","onClick","close","body","e","target","requestAnimationFrame","classList","add","remove","setTimeout","parentNode","removeChild","API","static","headers","Accept","setCsrfToken","token","headerName","defaults","verifyLicense","licenseKey","fetch","method","JSON","stringify","origin","window","location","then","res","json","get","url","request","post","data","finalOptions","response","isJson","includes","text","ok","status","error","console","peyek","constructor","Utils","version","isPremium","init","log","license","autoDetectCsrf","result","valid","warn","laravelToken","querySelector","getAttribute","yiiToken","yiiTokenValue"],"mappings":"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"}