{"version":3,"file":"peyek.pdf-viewer.min.js","sources":["../packages/core/src/utils.js","../packages/pdf-viewer/src/pdf.worker.js","../packages/pdf-viewer/src/viewer.js"],"sourcesContent":["/**\r\n * P.E.Y.E.K Core Utilities\r\n */\r\n\r\n/**\r\n * Creates an HTML element with attributes and children.\r\n * @param {string} tag\r\n * @param {Object} attributes\r\n * @param {Array<HTMLElement|string>} children\r\n * @returns {HTMLElement}\r\n */\r\nexport function createElement(tag, attributes = {}, children = []) {\r\n    const el = document.createElement(tag);\r\n\r\n    for (const [key, value] of Object.entries(attributes)) {\r\n        if (key.startsWith('on') && typeof value === 'function') {\r\n            const event = key.substring(2).toLowerCase();\r\n            el.addEventListener(event, value);\r\n        } else if (key === 'className') {\r\n            el.className = value;\r\n        } else if (key === 'style' && typeof value === 'object') {\r\n            Object.assign(el.style, value);\r\n        } else {\r\n            el.setAttribute(key, value);\r\n        }\r\n    }\r\n\r\n    children.forEach(child => {\r\n        if (typeof child === 'string') {\r\n            el.appendChild(document.createTextNode(child));\r\n        } else if (child instanceof HTMLElement) {\r\n            el.appendChild(child);\r\n        }\r\n    });\r\n\r\n    return el;\r\n}\r\n\r\n/**\r\n * Generates a unique ID\r\n * @returns {string}\r\n */\r\nexport function generateUniqueId() {\r\n    return 'peyek_' + Math.random().toString(36).substr(2, 9);\r\n}\r\n","/**\r\n * PDF Worker Setup for P.E.Y.E.K\r\n */\r\n\r\nconst PDFJS_VERSION = '3.4.120'; // Compatible stable version\r\n\r\nexport function setupWorker() {\r\n    return new Promise((resolve, reject) => {\r\n        if (window.pdfjsLib) {\r\n            resolve();\r\n            return;\r\n        }\r\n\r\n        // Load pdf.js library dynamically if not present\r\n        const script = document.createElement('script');\r\n        script.src = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${PDFJS_VERSION}/pdf.min.js`;\r\n        script.onload = () => {\r\n            // Setup the worker src from CDN after main library loads\r\n            if (window.pdfjsLib) {\r\n                window.pdfjsLib.GlobalWorkerOptions.workerSrc = `https://cdnjs.cloudflare.com/ajax/libs/pdf.js/${PDFJS_VERSION}/pdf.worker.min.js`;\r\n            }\r\n            resolve();\r\n        };\r\n        script.onerror = (e) => reject(new Error('Failed to load pdf.js from CDN'));\r\n        document.head.appendChild(script);\r\n    });\r\n}\r\n","import { Utils } from '@rterizz23/peyek-core';\r\nimport { setupWorker } from './pdf.worker.js';\r\n\r\nconst VIEWER_CSS = `\r\n  .peyek-pdf-container {\r\n    width: 100%;\r\n    height: 100%;\r\n    overflow: auto;\r\n    background: #e9e9e9;\r\n    padding: 20px;\r\n    box-sizing: border-box;\r\n    display: flex;\r\n    flex-direction: column;\r\n    align-items: center;\r\n  }\r\n  .peyek-pdf-page {\r\n    margin-bottom: 20px;\r\n    box-shadow: 0 4px 10px rgba(0,0,0,0.1);\r\n    background: #fff;\r\n  }\r\n  .peyek-pdf-toolbar {\r\n    width: 100%;\r\n    padding: 10px;\r\n    background: #333;\r\n    color: white;\r\n    display: flex;\r\n    justify-content: space-between;\r\n    margin-bottom: 20px;\r\n    border-radius: 4px;\r\n    box-sizing: border-box;\r\n  }\r\n  .peyek-pdf-toolbar button {\r\n    background: #555;\r\n    color: white;\r\n    border: none;\r\n    padding: 6px 12px;\r\n    border-radius: 4px;\r\n    cursor: pointer;\r\n  }\r\n  .peyek-pdf-toolbar button:hover {\r\n    background: #777;\r\n  }\r\n`;\r\n\r\n/**\r\n * P.E.Y.E.K PDF Viewer\r\n * Requires pdf.js to be available globally (`window.pdfjsLib`) or it will attempt to load it from CDN.\r\n */\r\nexport class PDFViewer {\r\n    constructor(containerId, options = {}) {\r\n        this.container = document.getElementById(containerId);\r\n        if (!this.container) throw new Error(`Container #${containerId} not found`);\r\n\r\n        this.url = options.url || null;\r\n        this.scale = options.scale || 1.5;\r\n        this.pdfDoc = null;\r\n        this.pageNum = 1;\r\n        this.pageRendering = false;\r\n        this.pageNumPending = null;\r\n\r\n        this.initStyles();\r\n        this.initHTML();\r\n    }\r\n\r\n    initStyles() {\r\n        if (!document.getElementById('peyek-pdf-styles')) {\r\n            const style = document.createElement('style');\r\n            style.id = 'peyek-pdf-styles';\r\n            style.textContent = VIEWER_CSS;\r\n            document.head.appendChild(style);\r\n        }\r\n    }\r\n\r\n    initHTML() {\r\n        this.container.innerHTML = '';\r\n\r\n        const wrapper = Utils.createElement('div', { className: 'peyek-pdf-container' });\r\n\r\n        // Toolbar\r\n        const toolbar = Utils.createElement('div', { className: 'peyek-pdf-toolbar' }, [\r\n            Utils.createElement('div', {}, [\r\n                Utils.createElement('button', {\r\n                    id: 'peyek-pdf-prev',\r\n                    onClick: () => this.onPrevPage()\r\n                }, ['Previous'])\r\n            ]),\r\n            Utils.createElement('div', {}, [\r\n                Utils.createElement('span', { id: 'peyek-pdf-page-num' }, ['1']),\r\n                ' / ',\r\n                Utils.createElement('span', { id: 'peyek-pdf-page-count' }, ['?'])\r\n            ]),\r\n            Utils.createElement('div', {}, [\r\n                Utils.createElement('button', {\r\n                    id: 'peyek-pdf-next',\r\n                    onClick: () => this.onNextPage()\r\n                }, ['Next'])\r\n            ])\r\n        ]);\r\n\r\n        // Canvas\r\n        const canvas = Utils.createElement('canvas', {\r\n            id: 'peyek-pdf-canvas',\r\n            className: 'peyek-pdf-page'\r\n        });\r\n\r\n        wrapper.appendChild(toolbar);\r\n        wrapper.appendChild(canvas);\r\n        this.container.appendChild(wrapper);\r\n\r\n        this.canvas = canvas;\r\n        this.ctx = canvas.getContext('2d');\r\n    }\r\n\r\n    async load(url) {\r\n        this.url = url || this.url;\r\n        if (!this.url) return;\r\n\r\n        await setupWorker();\r\n\r\n        try {\r\n            this.pdfDoc = await window.pdfjsLib.getDocument(this.url).promise;\r\n            document.getElementById('peyek-pdf-page-count').textContent = this.pdfDoc.numPages;\r\n            this.renderPage(this.pageNum);\r\n        } catch (error) {\r\n            console.error('[P.E.Y.E.K] Error loading PDF:', error);\r\n            this.container.innerHTML = '<div style=\"color:red; padding: 20px;\">Failed to load PDF. Check console for details.</div>';\r\n        }\r\n    }\r\n\r\n    async renderPage(num) {\r\n        this.pageRendering = true;\r\n\r\n        try {\r\n            const page = await this.pdfDoc.getPage(num);\r\n            const viewport = page.getViewport({ scale: this.scale });\r\n\r\n            this.canvas.height = viewport.height;\r\n            this.canvas.width = viewport.width;\r\n\r\n            const renderContext = {\r\n                canvasContext: this.ctx,\r\n                viewport: viewport\r\n            };\r\n\r\n            await page.render(renderContext).promise;\r\n            this.pageRendering = false;\r\n\r\n            if (this.pageNumPending !== null) {\r\n                this.renderPage(this.pageNumPending);\r\n                this.pageNumPending = null;\r\n            }\r\n        } catch (e) {\r\n            console.error(e);\r\n        }\r\n\r\n        document.getElementById('peyek-pdf-page-num').textContent = num;\r\n    }\r\n\r\n    queueRenderPage(num) {\r\n        if (this.pageRendering) {\r\n            this.pageNumPending = num;\r\n        } else {\r\n            this.renderPage(num);\r\n        }\r\n    }\r\n\r\n    onPrevPage() {\r\n        if (this.pageNum <= 1) return;\r\n        this.pageNum--;\r\n        this.queueRenderPage(this.pageNum);\r\n    }\r\n\r\n    onNextPage() {\r\n        if (this.pageNum >= this.pdfDoc.numPages) return;\r\n        this.pageNum++;\r\n        this.queueRenderPage(this.pageNum);\r\n    }\r\n}\r\n"],"names":["createElement","tag","attributes","children","el","document","key","value","Object","entries","startsWith","event","substring","toLowerCase","addEventListener","className","assign","style","setAttribute","forEach","child","appendChild","createTextNode","HTMLElement","PDFJS_VERSION","setupWorker","Promise","resolve","reject","window","pdfjsLib","script","src","onload","GlobalWorkerOptions","workerSrc","onerror","e","Error","head","constructor","containerId","options","this","container","getElementById","url","scale","pdfDoc","pageNum","pageRendering","pageNumPending","initStyles","initHTML","id","textContent","innerHTML","wrapper","Utils.createElement","toolbar","onClick","onPrevPage","onNextPage","canvas","ctx","getContext","load","getDocument","promise","numPages","renderPage","error","console","num","page","getPage","viewport","getViewport","height","width","renderContext","canvasContext","render","queueRenderPage"],"mappings":"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"}